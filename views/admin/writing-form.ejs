<%- include("../partials/admin-start", { title }) %>

<h1 class="text-3xl font-serif text-thought mb-8"><%= post ? "Edit Post" : "New Post" %></h1>

<% if (typeof saved !== 'undefined' && saved) { %>
  <div class="mb-6 border border-action/30 bg-white p-4 text-thought/80">Saved.</div>
<% } %>
<% if (error) { %>
  <div class="mb-6 border border-red-500/30 bg-white p-4 text-red-500"><%= error %></div>
<% } %>

<% const isEditing = !!post; %>
<% const actionUrl = isEditing ? `/admin/writing/${encodeURIComponent(post.id)}` : "/admin/writing/new"; %>

<form method="post" action="<%= actionUrl %>" class="space-y-6 bg-white p-8 border border-warmth/20">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div>
      <label class="block text-thought font-medium mb-2" for="title">Title</label>
      <input
        id="title"
        type="text"
        name="title"
        value="<%= post ? post.title : '' %>"
        required
        class="w-full p-3 border border-warmth/30 focus:border-thought outline-none"
      />
    </div>

    <div>
      <label class="block text-thought font-medium mb-2" for="category">Category</label>
      <select id="category" name="category" required class="w-full p-3 border border-warmth/30 focus:border-thought outline-none bg-white">
        <option value="">Select a category</option>
        <% (categories || []).forEach((cat) => { %>
          <option value="<%= cat %>" <%= post && post.category === cat ? 'selected' : '' %>><%= cat %></option>
        <% }) %>
      </select>
    </div>
  </div>

  <div>
    <label class="block text-thought font-medium mb-2" for="content">Content (Rich Text / HTML)</label>
    <textarea id="content" name="content" required rows="12" class="w-full p-3 border border-warmth/30 focus:border-thought outline-none font-mono text-sm"><%= post ? post.content : '' %></textarea>
    <p class="text-sm text-thought/60 mt-1">Supports HTML.</p>
  </div>

  <div class="flex items-center space-x-3">
    <input
      type="checkbox"
      name="published"
      id="published"
      <%= post && post.published ? "checked" : "" %>
      class="h-5 w-5 text-action border-warmth/30 rounded focus:ring-action"
    />
    <label for="published" class="text-thought font-medium select-none">Publish immediately</label>
  </div>

  <div class="pt-4 border-t border-warmth/20">
    <button type="submit" class="bg-action text-white px-8 py-3 font-medium hover:bg-action/90 transition-colors">
      <%= isEditing ? "Update Post" : "Create Post" %>
    </button>
    <a href="/admin/writing" class="ml-3 text-sm text-thought/60 hover:text-thought">Cancel</a>
  </div>
</form>

<%- include("../partials/admin-end") %>

